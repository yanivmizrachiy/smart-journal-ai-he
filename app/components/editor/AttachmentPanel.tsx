import { useEffect,useState } from 'react'; import { saveFile,listFiles,getFile } from '../../lib/files'
export default function AttachmentPanel({day}:{day:string}){const [items,setItems]=useState<any[]>([]);useEffect(()=>{(async()=>setItems(await listFiles(day)))()},[day]);async function up(e:any){const fs=e.target.files;if(!fs)return;for(const f of Array.from(fs))await saveFile(day,f);setItems(await listFiles(day))}return(<section style={{background:'#fff',border:'1px solid #e5e7eb',borderRadius:12,padding:10,marginTop:12}}><h3>קבצים ותמונות</h3><input type="file" multiple onChange={up}/><div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(140px,1fr))',gap:8,marginTop:8}}>{items.map(m=><Thumb key={m.id} meta={m}/>)}</div></section>)}
function Thumb({meta}:{meta:any}){const [url,setUrl]=useState('');useEffect(()=>{(async()=>{const b=await getFile(meta.id);if(b)setUrl(URL.createObjectURL(b))})()},[meta.id]);return(<figure style={{border:'1px solid #e5e7eb',borderRadius:10,padding:6}}>{url?<img src={url} alt={meta.name} style={{width:'100%',borderRadius:8}}/>:meta.name}</figure>)}
